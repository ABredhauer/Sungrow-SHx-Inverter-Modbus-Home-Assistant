# To use these scripts include following line in top of the configuration.yaml
# script: !include scripts.yaml

# Usage: Use these scripts to simplify automations
# Example (Adjust to your needs with appropriate trigger): 
# automation:
#  - alias: Forced Battery Charging Management
#    description: "Manages forced battery charging during cheapest hours based on battery level."
#   trigger:
#      - platform: state
#        entity_id: 
#          - binary_sensor.cheapest_hours_for_charging_timer
#    action:
#      - choose:
#          - conditions:
#              - condition: state
#                entity_id: binary_sensor.cheapest_hours_for_charging_timer
#                state: 'on'
#            sequence:
#              - service: script.forced_charge_battery
#          - conditions:
#              - condition: state
#                entity_id: binary_sensor.cheapest_hours_for_charging_timer
#                state: 'off'
#            sequence:
#              - service: script.self_consumption_mode
  


forced_discharge_battery:
    sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_ems_mode
          option: "Forced mode"
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_battery_forced_charge_discharge_cmd
          option: "Forced discharge"
      - service: notify.notify
        data:
          title: "Forced Battery Discharge"
          message: "Switched to Forced Battery Discharge."
          
forced_charge_battery:
    sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_ems_mode
          option: "Forced mode"
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_battery_forced_charge_discharge_cmd
          option: "Forced charge"
      - service: notify.notify
        data:
          title: "Forced Battery Charging"
          message: "Starting forced battery charging during cheapest hours."
          
self_consumption_mode:
    sequence:
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_ems_mode
          option: "Self-consumption mode (default)"
      - service: input_select.select_option
        data:
          entity_id: input_select.set_sg_battery_forced_charge_discharge_cmd
          option: "Stop (default)"
      - service: notify.notify
        data:
          title: "Forced Battery Charging Ended"
          message: "Reset to default settings. Forced battery charging ended."